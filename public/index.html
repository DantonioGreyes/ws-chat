<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Chat</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            #box {
                width: 500px;
                height: 200px;
                overflow-x: auto;
                border: 2px solid gray;
                font-family: monospace;
            }
        </style>
    </head>
    <body>
        <div id="box"></div>
        <input type="text" id="msg">
        <!--<script src="client.js"></script>-->
    </body>
</html>
<script>
    let getUrl = window.location;
    let baseUrl = getUrl.protocol + "//" + getUrl.host + "/" + getUrl.pathname.split('/')[0];
    const connection = new WebSocket('ws://'+baseUrl+':12345'),
        box = document.getElementById('box'),
        msg = document.getElementById('msg');

    connection.addEventListener('open', () => {
        console.log('connected');
    });

    connection.addEventListener('message', e => {
        let p = document.createElement('p');
        p.textContent = e.data;
        box.appendChild(p);
    });

    function send (data) {
        if (connection.readyState === WebSocket.OPEN) {
            connection.send(data);
        } else {
            throw 'Not connected';
        }
    }

    msg.addEventListener('keydown', e => {
        let kc = e.which || e.keyCode;

        if (kc === 13) {
            send(msg.value);
            msg.value = '';
        }
    });

</script>